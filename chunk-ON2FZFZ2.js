import{a as T}from"./chunk-2WQAUUU7.js";import{D as h,X as b,a as l,b as p,ca as d,ga as S,j as u,n as s,x as a}from"./chunk-EYER3JCQ.js";var v=class o{constructor(e){this.apiService=e}tripsSubject=new s([]);currentTripSubject=new s(null);loadingSubject=new s(!1);errorSubject=new s(null);trips$=this.tripsSubject.asObservable();currentTrip$=this.currentTripSubject.asObservable();loading$=this.loadingSubject.asObservable();error$=this.errorSubject.asObservable();loadTrips(){return this.loadingSubject.next(!0),this.errorSubject.next(null),this.apiService.getTrips().pipe(a(e=>(this.tripsSubject.next(e),this.loadingSubject.next(!1),e)))}loadTripWithDetails(e){this.loadingSubject.next(!0),this.errorSubject.next(null);let i={vehicles:this.apiService.getVehicles(),locations:this.apiService.getLocations()};return h(i).pipe(a(({vehicles:t,locations:r})=>{let j=t.find(n=>n.id===e.vehicleId),f=r.find(n=>n.id===e.startLocationId),g=r.find(n=>n.id===e.endLocationId),c=p(l({},e),{vehicle:j,startLocation:f,endLocation:g});return this.currentTripSubject.next(c),this.loadingSubject.next(!1),c}))}loadLatestTrip(){return this.loadingSubject.next(!0),this.apiService.getTrips().pipe(b(e=>{if(e.length===0)return this.loadingSubject.next(!1),new u(t=>{t.next(null),t.complete()});let i=e.filter(t=>t.status==="completed").sort((t,r)=>new Date(r.endDate||r.startDate).getTime()-new Date(t.endDate||t.startDate).getTime())[0]||e[0];return this.loadTripWithDetails(i)}))}getTripsByUserId(e){return this.loadingSubject.next(!0),this.apiService.getTrips().pipe(a(i=>{let t=i.filter(r=>r.userId===e);return this.tripsSubject.next(t),this.loadingSubject.next(!1),t}))}getCurrentTrip(){return this.currentTripSubject.value}setError(e){this.errorSubject.next(e)}clearError(){this.errorSubject.next(null)}static \u0275fac=function(i){return new(i||o)(S(T))};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{v as a};
