import{b as d}from"./chunk-AVFLOUFI.js";import{a as E}from"./chunk-WXPR64CH.js";import{a as K}from"./chunk-QHL7TNPJ.js";import{Ba as v,Eb as I,Fb as O,Fc as p,Gb as z,Ib as V,Jb as A,Jc as t,Kb as b,Lb as S,Mb as w,Nb as P,Ob as B,Pb as j,Qb as _,Yb as W,Zb as N,_a as C,_b as G,a as m,ac as k,b as l,bc as y,ca as g,cc as x,f as Z,ha as c,hc as Q,jc as q,kc as U,lb as u,tb as o,uc as $,v as R,vc as H,wb as F,wc as L,ya as f}from"./chunk-EYER3JCQ.js";var te=["container"],J=(()=>{class r{mapService=c(d);accessToken=t();collectResourceTiming=t();crossSourceCollisions=t();fadeDuration=t();hash=t();refreshExpiredTiles=t();failIfMajorPerformanceCaveat=t();bearingSnap=t();interactive=t();pitchWithRotate=t();clickTolerance=t();attributionControl=t();logoPosition=t();maxTileCacheSize=t();localIdeographFontFamily=t();preserveDrawingBuffer=t();trackResize=t();transformRequest=t();bounds=t();antialias=t();locale=t();cooperativeGestures=t();minZoom=t();maxZoom=t();minPitch=t();maxPitch=t();scrollZoom=t();dragRotate=t();touchPitch=t();touchZoomRotate=t();doubleClickZoom=t();keyboard=t();dragPan=t();boxZoom=t();style=t();center=t();maxBounds=t();zoom=t();bearing=t();pitch=t();fitBoundsOptions=t();renderWorldCopies=t();projection=t();movingMethod=t("flyTo");movingOptions=t();fitBounds=t();fitScreenCoordinates=t();centerWithPanTo=t();panToOptions=t();cursorStyle=t();mapResize=new o;mapRemove=new o;mapMouseDown=new o;mapMouseUp=new o;mapMouseMove=new o;mapClick=new o;mapDblClick=new o;mapMouseOver=new o;mapMouseOut=new o;mapContextMenu=new o;mapTouchStart=new o;mapTouchEnd=new o;mapTouchMove=new o;mapTouchCancel=new o;mapWheel=new o;moveStart=new o;move=new o;moveEnd=new o;mapDragStart=new o;mapDrag=new o;mapDragEnd=new o;zoomStart=new o;zoomEvt=new o;zoomEnd=new o;rotateStart=new o;rotate=new o;rotateEnd=new o;pitchStart=new o;pitchEvt=new o;pitchEnd=new o;boxZoomStart=new o;boxZoomEnd=new o;boxZoomCancel=new o;webGlContextLost=new o;webGlContextRestored=new o;mapLoad=new o;mapCreate=new o;idle=new o;render=new o;mapError=new o;data=new o;styleData=new o;sourceData=new o;dataLoading=new o;styleDataLoading=new o;sourceDataLoading=new o;styleImageMissing=new o;get mapInstance(){return this.mapService.mapInstance}mapContainer;constructor(){F(()=>{this.mapService.setup({accessToken:this.accessToken(),mapOptions:{collectResourceTiming:this.collectResourceTiming(),container:this.mapContainer.nativeElement,crossSourceCollisions:this.crossSourceCollisions(),fadeDuration:this.fadeDuration(),minZoom:this.minZoom(),maxZoom:this.maxZoom(),minPitch:this.minPitch(),maxPitch:this.maxPitch(),style:this.style(),hash:this.hash(),interactive:this.interactive(),bearingSnap:this.bearingSnap(),pitchWithRotate:this.pitchWithRotate(),clickTolerance:this.clickTolerance(),attributionControl:this.attributionControl(),logoPosition:this.logoPosition(),failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat(),preserveDrawingBuffer:this.preserveDrawingBuffer(),refreshExpiredTiles:this.refreshExpiredTiles(),maxBounds:this.maxBounds(),scrollZoom:this.scrollZoom(),boxZoom:this.boxZoom(),dragRotate:this.dragRotate(),dragPan:this.dragPan(),keyboard:this.keyboard(),doubleClickZoom:this.doubleClickZoom(),touchPitch:this.touchPitch(),touchZoomRotate:this.touchZoomRotate(),trackResize:this.trackResize(),center:this.center(),zoom:this.zoom(),bearing:this.bearing(),pitch:this.pitch(),renderWorldCopies:this.renderWorldCopies(),maxTileCacheSize:this.maxTileCacheSize(),localIdeographFontFamily:this.localIdeographFontFamily(),transformRequest:this.transformRequest(),bounds:this.bounds()?this.bounds():this.fitBounds(),fitBoundsOptions:this.fitBoundsOptions(),antialias:this.antialias(),locale:this.locale(),cooperativeGestures:this.cooperativeGestures(),projection:this.projection()},mapEvents:this}),this.cursorStyle()&&this.mapService.changeCanvasCursor(this.cursorStyle())})}ngOnDestroy(){this.mapService.destroyMap()}ngOnChanges(e){return Z(this,null,function*(){if(yield R(this.mapService.mapCreated$),e.cursorStyle&&!e.cursorStyle.isFirstChange()&&this.mapService.changeCanvasCursor(e.cursorStyle.currentValue),e.projection&&!e.projection.isFirstChange()&&this.mapService.updateProjection(e.projection.currentValue),e.minZoom&&!e.minZoom.isFirstChange()&&this.mapService.updateMinZoom(e.minZoom.currentValue),e.maxZoom&&!e.maxZoom.isFirstChange()&&this.mapService.updateMaxZoom(e.maxZoom.currentValue),e.minPitch&&!e.minPitch.isFirstChange()&&this.mapService.updateMinPitch(e.minPitch.currentValue),e.maxPitch&&!e.maxPitch.isFirstChange()&&this.mapService.updateMaxPitch(e.maxPitch.currentValue),e.renderWorldCopies&&!e.renderWorldCopies.isFirstChange()&&this.mapService.updateRenderWorldCopies(e.renderWorldCopies.currentValue),e.scrollZoom&&!e.scrollZoom.isFirstChange()&&this.mapService.updateScrollZoom(e.scrollZoom.currentValue),e.dragRotate&&!e.dragRotate.isFirstChange()&&this.mapService.updateDragRotate(e.dragRotate.currentValue),e.touchPitch&&!e.touchPitch.isFirstChange()&&this.mapService.updateTouchPitch(e.touchPitch.currentValue),e.touchZoomRotate&&!e.touchZoomRotate.isFirstChange()&&this.mapService.updateTouchZoomRotate(e.touchZoomRotate.currentValue),e.doubleClickZoom&&!e.doubleClickZoom.isFirstChange()&&this.mapService.updateDoubleClickZoom(e.doubleClickZoom.currentValue),e.keyboard&&!e.keyboard.isFirstChange()&&this.mapService.updateKeyboard(e.keyboard.currentValue),e.dragPan&&!e.dragPan.isFirstChange()&&this.mapService.updateDragPan(e.dragPan.currentValue),e.boxZoom&&!e.boxZoom.isFirstChange()&&this.mapService.updateBoxZoom(e.boxZoom.currentValue),e.style&&!e.style.isFirstChange()&&this.mapService.updateStyle(e.style.currentValue),e.maxBounds&&!e.maxBounds.isFirstChange()&&this.mapService.updateMaxBounds(e.maxBounds.currentValue),e.fitBounds&&e.fitBounds.currentValue&&!e.fitBounds.isFirstChange()&&this.mapService.fitBounds(e.fitBounds.currentValue,this.fitBoundsOptions()),e.fitScreenCoordinates&&e.fitScreenCoordinates.currentValue){(this.center()||this.zoom()||this.pitch()||this.fitBounds())&&e.fitScreenCoordinates.isFirstChange()&&console.warn("[ngx-mapbox-gl] center / zoom / pitch / fitBounds inputs are being overridden by fitScreenCoordinates input");let a=this.bearing();this.mapService.fitScreenCoordinates(e.fitScreenCoordinates.currentValue,Array.isArray(a)?a[0]:a||0,this.movingOptions())}if(this.centerWithPanTo()&&e.center&&!e.center.isFirstChange()&&!e.zoom&&!e.bearing&&!e.pitch)this.mapService.panTo(this.center(),this.panToOptions());else if(e.center&&!e.center.isFirstChange()||e.zoom&&!e.zoom.isFirstChange()||e.bearing&&!e.bearing.isFirstChange()&&!e.fitScreenCoordinates||e.pitch&&!e.pitch.isFirstChange()){let a=this.zoom(),s=this.center(),n=this.bearing(),h=this.pitch();this.mapService.move(this.movingMethod(),this.movingOptions(),e.zoom&&a?Array.isArray(a)?a[0]:a:void 0,e.center?s:void 0,e.bearing&&n?Array.isArray(n)?n[0]:n:void 0,e.pitch&&h?Array.isArray(h)?h[0]:h:void 0)}})}static \u0275fac=function(a){return new(a||r)};static \u0275cmp=u({type:r,selectors:[["mgl-map"]],viewQuery:function(a,s){if(a&1&&k(te,7),a&2){let n;y(n=x())&&(s.mapContainer=n.first)}},inputs:{accessToken:[1,"accessToken"],collectResourceTiming:[1,"collectResourceTiming"],crossSourceCollisions:[1,"crossSourceCollisions"],fadeDuration:[1,"fadeDuration"],hash:[1,"hash"],refreshExpiredTiles:[1,"refreshExpiredTiles"],failIfMajorPerformanceCaveat:[1,"failIfMajorPerformanceCaveat"],bearingSnap:[1,"bearingSnap"],interactive:[1,"interactive"],pitchWithRotate:[1,"pitchWithRotate"],clickTolerance:[1,"clickTolerance"],attributionControl:[1,"attributionControl"],logoPosition:[1,"logoPosition"],maxTileCacheSize:[1,"maxTileCacheSize"],localIdeographFontFamily:[1,"localIdeographFontFamily"],preserveDrawingBuffer:[1,"preserveDrawingBuffer"],trackResize:[1,"trackResize"],transformRequest:[1,"transformRequest"],bounds:[1,"bounds"],antialias:[1,"antialias"],locale:[1,"locale"],cooperativeGestures:[1,"cooperativeGestures"],minZoom:[1,"minZoom"],maxZoom:[1,"maxZoom"],minPitch:[1,"minPitch"],maxPitch:[1,"maxPitch"],scrollZoom:[1,"scrollZoom"],dragRotate:[1,"dragRotate"],touchPitch:[1,"touchPitch"],touchZoomRotate:[1,"touchZoomRotate"],doubleClickZoom:[1,"doubleClickZoom"],keyboard:[1,"keyboard"],dragPan:[1,"dragPan"],boxZoom:[1,"boxZoom"],style:[1,"style"],center:[1,"center"],maxBounds:[1,"maxBounds"],zoom:[1,"zoom"],bearing:[1,"bearing"],pitch:[1,"pitch"],fitBoundsOptions:[1,"fitBoundsOptions"],renderWorldCopies:[1,"renderWorldCopies"],projection:[1,"projection"],movingMethod:[1,"movingMethod"],movingOptions:[1,"movingOptions"],fitBounds:[1,"fitBounds"],fitScreenCoordinates:[1,"fitScreenCoordinates"],centerWithPanTo:[1,"centerWithPanTo"],panToOptions:[1,"panToOptions"],cursorStyle:[1,"cursorStyle"]},outputs:{mapResize:"mapResize",mapRemove:"mapRemove",mapMouseDown:"mapMouseDown",mapMouseUp:"mapMouseUp",mapMouseMove:"mapMouseMove",mapClick:"mapClick",mapDblClick:"mapDblClick",mapMouseOver:"mapMouseOver",mapMouseOut:"mapMouseOut",mapContextMenu:"mapContextMenu",mapTouchStart:"mapTouchStart",mapTouchEnd:"mapTouchEnd",mapTouchMove:"mapTouchMove",mapTouchCancel:"mapTouchCancel",mapWheel:"mapWheel",moveStart:"moveStart",move:"move",moveEnd:"moveEnd",mapDragStart:"mapDragStart",mapDrag:"mapDrag",mapDragEnd:"mapDragEnd",zoomStart:"zoomStart",zoomEvt:"zoomEvt",zoomEnd:"zoomEnd",rotateStart:"rotateStart",rotate:"rotate",rotateEnd:"rotateEnd",pitchStart:"pitchStart",pitchEvt:"pitchEvt",pitchEnd:"pitchEnd",boxZoomStart:"boxZoomStart",boxZoomEnd:"boxZoomEnd",boxZoomCancel:"boxZoomCancel",webGlContextLost:"webGlContextLost",webGlContextRestored:"webGlContextRestored",mapLoad:"mapLoad",mapCreate:"mapCreate",idle:"idle",render:"render",mapError:"mapError",data:"data",styleData:"styleData",sourceData:"sourceData",dataLoading:"dataLoading",styleDataLoading:"styleDataLoading",sourceDataLoading:"sourceDataLoading",styleImageMissing:"styleImageMissing"},features:[$([d]),v],decls:2,vars:0,consts:[["container",""]],template:function(a,s){a&1&&_(0,"div",null,0)},styles:["[_nghost-%COMP%]{display:block}div[_ngcontent-%COMP%]{height:100%;width:100%}"],changeDetection:0})}return r})();var oe=["content"],ie=["*"],X=(()=>{class r{mapService=c(d);offset=t();anchor=t();clickTolerance=t();feature=t();lngLat=t();draggable=t();popupShown=t();className=t();zIndex=t();pitchAlignment=t();rotationAlignment=t();markerDragStart=new o;markerDragEnd=new o;markerDrag=new o;content;markerInstance;ngOnInit(){if(this.feature()&&this.lngLat())throw new Error("feature and lngLat input are mutually exclusive")}ngOnChanges(e){e.lngLat&&!e.lngLat.isFirstChange()&&this.markerInstance.setLngLat(this.lngLat()),e.feature&&!e.feature.isFirstChange()&&this.markerInstance.setLngLat(this.feature().geometry.coordinates),e.draggable&&!e.draggable.isFirstChange()&&this.markerInstance.setDraggable(!!this.draggable()),e.popupShown&&!e.popupShown.isFirstChange()&&(e.popupShown.currentValue?this.markerInstance.getPopup()?.addTo(this.mapService.mapInstance):this.markerInstance.getPopup()?.remove()),e.pitchAlignment&&!e.pitchAlignment.isFirstChange()&&this.markerInstance.setPitchAlignment(e.pitchAlignment.currentValue),e.rotationAlignment&&!e.rotationAlignment.isFirstChange()&&this.markerInstance.setRotationAlignment(e.rotationAlignment.currentValue)}ngAfterViewInit(){this.mapService.mapCreated$.subscribe(()=>{this.markerInstance=this.mapService.addMarker({markersOptions:{offset:this.offset(),anchor:this.anchor(),pitchAlignment:this.pitchAlignment(),rotationAlignment:this.rotationAlignment(),draggable:this.draggable(),element:this.content.nativeElement,feature:this.feature(),lngLat:this.lngLat(),clickTolerance:this.clickTolerance()},markersEvents:{markerDragStart:this.markerDragStart,markerDrag:this.markerDrag,markerDragEnd:this.markerDragEnd}})})}ngOnDestroy(){this.mapService.removeMarker(this.markerInstance),this.markerInstance=void 0}togglePopup(){this.markerInstance.togglePopup()}updateCoordinates(e){this.markerInstance.setLngLat(e)}static \u0275fac=function(a){return new(a||r)};static \u0275cmp=u({type:r,selectors:[["mgl-marker"]],viewQuery:function(a,s){if(a&1&&k(oe,7),a&2){let n;y(n=x())&&(s.content=n.first)}},inputs:{offset:[1,"offset"],anchor:[1,"anchor"],clickTolerance:[1,"clickTolerance"],feature:[1,"feature"],lngLat:[1,"lngLat"],draggable:[1,"draggable"],popupShown:[1,"popupShown"],className:[1,"className"],zIndex:[1,"zIndex"],pitchAlignment:[1,"pitchAlignment"],rotationAlignment:[1,"rotationAlignment"]},outputs:{markerDragStart:"markerDragStart",markerDragEnd:"markerDragEnd",markerDrag:"markerDrag"},features:[v],ngContentSelectors:ie,decls:3,vars:4,consts:[["content",""]],template:function(a,s){a&1&&(N(),B(0,"div",null,0),G(2),j()),a&2&&(U(s.className()),Q("z-index",s.zIndex()))},encapsulation:2,changeDetection:0})}return r})();var M=class r{http=c(K);baseUrl=`${E.apiUrl}${E.endpoints.locations}`;getAll(){return this.http.get(this.baseUrl)}getById(i){return this.http.get(`${this.baseUrl}/${i}`)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=g({token:r,factory:r.\u0275fac,providedIn:"root"})};var D=class r{state=f({trips:[],currentTrip:null,currentVehicle:null,currentLocation:null,locations:[],loading:!1,error:null});trips=p(()=>this.state().trips);currentTrip=p(()=>this.state().currentTrip);currentVehicle=p(()=>this.state().currentVehicle);currentLocation=p(()=>this.state().currentLocation);locations=p(()=>this.state().locations);loading=p(()=>this.state().loading);error=p(()=>this.state().error);setTrips(i){this.state.update(e=>l(m({},e),{trips:i}))}setCurrentTrip(i){this.state.update(e=>l(m({},e),{currentTrip:i}))}setCurrentVehicle(i){this.state.update(e=>l(m({},e),{currentVehicle:i}))}setCurrentLocation(i){this.state.update(e=>l(m({},e),{currentLocation:i}))}setLocations(i){this.state.update(e=>l(m({},e),{locations:i}))}setLoading(i){this.state.update(e=>l(m({},e),{loading:i}))}setError(i){this.state.update(e=>l(m({},e),{error:i}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=g({token:r,factory:r.\u0275fac,providedIn:"root"})};var re=()=>[12],ee=(r,i)=>[r,i];function ae(r,i){if(r&1&&(S(0,"mgl-marker",2),P(1,"img",3),w()),r&2){let e=i.$implicit;b("lngLat",L(1,ee,e.lng,e.lat))}}function ne(r,i){if(r&1&&(S(0,"mgl-marker",2),P(1,"div",4),w()),r&2){let e=W();b("lngLat",e.userLocation())}}var Y=class r{locationsApi=c(M);tripStore=c(D);userLocation=f(null);markers=[];watchId;ngOnInit(){this.loadLocations(),this.startLocationTracking()}loadLocations(){this.locationsApi.getAll().subscribe({next:i=>{this.tripStore.setLocations(i),this.markers=i.map(e=>({lng:e.coordinates.lng,lat:e.coordinates.lat}))},error:i=>{console.error("Error al cargar ubicaciones:",i)}})}startLocationTracking(){"geolocation"in navigator?this.watchId=navigator.geolocation.watchPosition(i=>{let{longitude:e,latitude:a}=i.coords;this.userLocation.set([e,a])},i=>{console.log("Error Obteniendo la ubicacion",i)},{enableHighAccuracy:!0,maximumAge:1e4,timeout:2e4}):alert("Tu navegador no soporta geolocalizacion")}ngOnDestroy(){this.watchId&&navigator.geolocation.clearWatch(this.watchId)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=u({type:r,selectors:[["app-trip-map"]],decls:5,vars:9,consts:[[1,"container-map"],[3,"zoom","center"],[3,"lngLat"],["src","https://cdn-icons-png.flaticon.com/512/684/684908.png","alt","marker",1,"google-marker"],[1,"user-marker"]],template:function(e,a){e&1&&(S(0,"div",0)(1,"mgl-map",1),V(2,ae,2,4,"mgl-marker",2,z),I(4,ne,2,1,"mgl-marker",2),w()()),e&2&&(C(),q("mapbox://styles/mapbox/streets-v12"),b("zoom",H(5,re))("center",L(6,ee,-77.0935755943619,-12.076630586486122)),C(),A(a.markers),C(2),O(a.userLocation()?4:-1))},dependencies:[J,X],styles:[".container-map[_ngcontent-%COMP%]{width:100%;height:50rem}mgl-map[_ngcontent-%COMP%]{height:100%;width:100%;display:block}.google-marker[_ngcontent-%COMP%]{width:36px;height:36px;cursor:pointer;transform:translate(-50%,-100%)}.user-marker[_ngcontent-%COMP%]{width:12px;height:12px;background-color:#007bff;border:3px solid white;border-radius:50%;box-shadow:0 0 6px #0000004d;transform:translate(-50%,-50%);animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #007bff66}70%{box-shadow:0 0 0 10px #007bff00}to{box-shadow:0 0 #007bff00}}"]})};export{Y as a};
